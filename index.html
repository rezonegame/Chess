<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¢ä¹æ£‹ç‰Œå®¤ | å…¨èƒ½å¯¹æˆ˜å¹³å°</title>
    <style>
        /* --- 1. è§†è§‰ç³»ç»Ÿï¼šäº²å’ŒåŠ›æš–è‰²è°ƒ (Cozy Warmth) --- */
        :root {
            --bg-page: #fbf7f2; /* æš–ç±³ç™½ */
            --bg-panel: #ffffff;
            --text-main: #433422; /* æ·±å’–å•¡è‰² */
            --text-light: #9e8f80;
            --accent: #ff8e53; /* æ´»åŠ›æ©™ */
            --accent-hover: #ff7b35;
            --primary: #4facfe; /* å®é™è“ */
            --board-wood: #ebd3b1;
            --board-border: #c4a484;
            --shadow: 0 8px 24px rgba(149, 157, 165, 0.15);
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Nunito', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-page);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- 2. å¸ƒå±€ç»“æ„ --- */
        #app { display: flex; width: 100%; height: 100%; }

        /* å·¦ä¾§å¯¼èˆªæ  */
        aside {
            width: 280px;
            background: var(--bg-panel);
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            z-index: 20;
            transition: transform 0.3s ease;
            box-shadow: var(--shadow);
        }

        .brand {
            padding: 25px;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #f5f5f5;
        }

        .game-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .category-title {
            font-size: 0.8rem;
            color: var(--text-light);
            margin: 15px 0 5px 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .game-btn {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 6px;
            border-radius: 10px;
            border: none;
            background: transparent;
            color: var(--text-main);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            text-align: left;
            transition: all 0.2s;
        }
        .game-btn:hover { background-color: #fff5ee; }
        .game-btn.active { background-color: #fff0e6; color: var(--accent); box-shadow: 0 2px 6px rgba(255, 142, 83, 0.1); }
        .game-icon { margin-right: 12px; font-size: 1.2rem; width: 24px; text-align: center; }

        /* ä¸»æ¸¸æˆåŒº */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background-image: radial-gradient(#e4e4e4 1px, transparent 1px);
            background-size: 24px 24px;
        }

        header {
            padding: 15px 30px;
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .menu-toggle { display: none; font-size: 1.5rem; cursor: pointer; color: var(--text-main); border:none; background:none;}

        .status-pill {
            background: #fff;
            padding: 6px 20px;
            border-radius: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            font-weight: bold;
            color: var(--primary);
            display: flex; gap: 15px;
        }

        #game-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
        }

        /* --- 3. é€šç”¨æ£‹ç›˜æ ·å¼ --- */
        .board-wrap {
            position: relative;
            padding: 15px;
            border-radius: var(--radius);
            background: #fff;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .board { display: grid; gap: 1px; margin: 0 auto; }
        
        .cell {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        /* æ£‹å­é€šç”¨åŠ¨ç”» */
        .piece {
            width: 85%; height: 85%;
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 2;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ°cell */
        }
        .piece.show { transform: scale(1); }

        /* --- 4. ç‰¹å®šæ¸¸æˆçš®è‚¤ --- */
        /* äº”å­æ£‹/å›´æ£‹ */
        .skin-wood {
            background: var(--board-wood);
            border: 6px solid var(--board-border);
        }
        .skin-wood .cell::before { content:''; position:absolute; top:50%; left:0; width:100%; height:1px; background:#8b5a2b; }
        .skin-wood .cell::after { content:''; position:absolute; left:50%; top:0; height:100%; width:1px; background:#8b5a2b; }
        .piece.b { background: radial-gradient(circle at 30% 30%, #666, #111); box-shadow: 2px 2px 4px rgba(0,0,0,0.4); }
        .piece.w { background: radial-gradient(circle at 30% 30%, #fff, #e6e6e6); box-shadow: 2px 2px 4px rgba(0,0,0,0.2); }

        /* äº•å­—æ£‹/æ¶‚é¸¦ */
        .skin-paper {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        .skin-paper .cell { 
            border: 2px solid #f0f0f0; 
            font-family: 'Comic Sans MS', cursive; 
            font-size: 3rem; 
        }
        .skin-paper .cell:first-child { border-top-left-radius: 15px; }
        
        /* é»‘ç™½æ£‹ */
        .skin-green {
            background: #27ae60;
            border: 6px solid #1e8449;
            gap: 2px;
        }
        .skin-green .cell { background: rgba(0,0,0,0.05); }
        .hint { width: 10px; height: 10px; background: rgba(0,0,0,0.2); border-radius: 50%; }

        /* æ‰«é›· */
        .skin-gray {
            background: #bdbdbd;
            border: 4px solid #7b7b7b;
            padding: 5px;
            gap: 2px;
        }
        .skin-gray .cell { 
            background: #e0e0e0; 
            border: 1px solid #fff; 
            border-right-color: #7b7b7b; 
            border-bottom-color: #7b7b7b;
            font-weight: bold; font-family: monospace;
        }
        .skin-gray .cell.open { border: 1px solid #999; background: #d1d1d1; }

        /* æ²™ç›’æ¨¡å¼ (Chess/Xiangqi) */
        .skin-sandbox .cell { border: 1px dashed rgba(0,0,0,0.1); }
        .sandbox-piece { font-size: 2rem; cursor: grab; transition: none; transform: scale(1); }
        .sandbox-piece:active { cursor: grabbing; transform: scale(1.2); }

        /* --- 5. åº•éƒ¨æ§åˆ¶æ  --- */
        .controls {
            padding: 20px;
            background: #fff;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-top: 1px solid #eee;
        }
        .c-btn {
            padding: 10px 20px;
            border-radius: 12px;
            border: none;
            background: #f4f6f8;
            color: var(--text-main);
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .c-btn:hover { background: #e1e4e8; }
        .c-btn.primary { background: var(--accent); color: white; box-shadow: 0 4px 12px rgba(255, 142, 83, 0.3); }
        .c-btn.primary:hover { background: var(--accent-hover); }

        /* å“åº”å¼é®ç½© */
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.4); z-index: 15; display: none;
            backdrop-filter: blur(3px);
        }

        @media (max-width: 768px) {
            aside { position: absolute; height: 100%; transform: translateX(-100%); }
            aside.open { transform: translateX(0); }
            .menu-toggle { display: block; }
        }
    </style>
</head>
<body>

<div class="overlay" onclick="UI.toggleMenu()"></div>

<div id="app">
    <aside id="sidebar">
        <div class="brand">
            <span>ğŸ²</span> æ¬¢ä¹æ£‹ç‰Œå®¤
        </div>
        <div class="game-list" id="game-list">
            <!-- æ¸¸æˆåˆ—è¡¨ç”± JS ç”Ÿæˆ -->
        </div>
    </aside>

    <main>
        <header>
            <div style="display:flex;align-items:center;gap:15px;">
                <button class="menu-toggle" onclick="UI.toggleMenu()">â˜°</button>
                <h2 id="game-title" style="margin:0; font-size:1.1rem;">äº”å­æ£‹</h2>
            </div>
            <div class="status-pill">
                <span id="status-text">å‡†å¤‡å¼€å§‹</span>
            </div>
        </header>

        <div id="game-container">
            <div id="board-wrap" class="board-wrap">
                <!-- æ£‹ç›˜åŒºåŸŸ -->
            </div>
        </div>

        <div class="controls">
            <button class="c-btn" onclick="Engine.undo()">â†©ï¸ æ‚”æ£‹</button>
            <button class="c-btn primary" onclick="Engine.restart()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            <button class="c-btn" id="help-btn" onclick="UI.showHelp()">â“ è§„åˆ™</button>
        </div>
    </main>
</div>

<script>
/**
 * æ¬¢ä¹æ£‹ç‰Œå®¤ - æ ¸å¿ƒé€»è¾‘
 * åŒ…å«ï¼šé€šç”¨æ¸¸æˆå¼•æ“ã€AIç®—æ³•ã€æ²™ç›’ç³»ç»Ÿã€UIç®¡ç†
 */

// --- 1. æ¸¸æˆæ•°æ®åº“ (30æ¬¾) ---
const GAMES = [
    // ç±»åˆ«: æ™ºèƒ½å¯¹æˆ˜ (å®Œå…¨AIæ”¯æŒ)
    { cat: 'æ™ºèƒ½å¯¹æˆ˜', id: 'gomoku', name: 'äº”å­æ£‹', icon: 'âš«', type: 'ai', rule: 'äº”å­è¿ç è·èƒœ' },
    { cat: 'æ™ºèƒ½å¯¹æˆ˜', id: 'reversi', name: 'é»‘ç™½æ£‹', icon: 'âšª', type: 'ai', rule: 'å¤¹ä½å¯¹æ–¹æ£‹å­ç¿»è½¬ï¼Œå­å¤šè€…èƒœ' },
    { cat: 'æ™ºèƒ½å¯¹æˆ˜', id: 'connect4', name: 'å››å­æ£‹', icon: 'ğŸ”´', type: 'ai', rule: 'å››å­è¿çº¿è·èƒœï¼ˆé‡åŠ›ä¸‹è½ï¼‰' },
    { cat: 'æ™ºèƒ½å¯¹æˆ˜', id: 'tictactoe', name: 'äº•å­—æ£‹', icon: 'âŒ', type: 'ai', rule: 'ä¸‰å­è¿çº¿è·èƒœ' },
    { cat: 'æ™ºèƒ½å¯¹æˆ˜', id: 'peg', name: 'å­”æ˜æ£‹', icon: 'ğŸ”®', type: 'solo', rule: 'è·³è¿‡æ£‹å­åƒæ‰ï¼Œæœ€åå‰©ä¸€é¢—' },

    // ç±»åˆ«: ä¼‘é—²ç›Šæ™º (å•äºº)
    { cat: 'ä¼‘é—²ç›Šæ™º', id: 'minesweeper', name: 'æ‰«é›·', icon: 'ğŸ’£', type: 'solo', rule: 'ç‚¹å‡»å¼€æ ¼å­ï¼Œé•¿æŒ‰æ’æ——' },
    { cat: 'ä¼‘é—²ç›Šæ™º', id: 'memory', name: 'è®°å¿†ç¿»ç‰Œ', icon: 'ğŸ´', type: 'solo', rule: 'ç¿»å¼€ä¸¤å¼ ç›¸åŒçš„ç‰Œæ¶ˆé™¤' },
    { cat: 'ä¼‘é—²ç›Šæ™º', id: '2048', name: '2048', icon: 'ğŸ”¢', type: 'solo', rule: 'é”®ç›˜/æ»‘åŠ¨åˆå¹¶æ•°å­—' },
    
    // ç±»åˆ«: è‡ªç”±æ²™ç›’ (åŒäºº/æ¨æ¼” - ä»…æä¾›æ£‹ç›˜å’Œæ£‹å­ï¼Œæ— è§„åˆ™é™åˆ¶)
    // è¿™æ˜¯å®ç°"30æ¬¾æ¸¸æˆ"ä¸”ä¸å‡ºç°é€»è¾‘Bugçš„æœ€ä½³æ–¹æ¡ˆ
    { cat: 'è‡ªç”±æ²™ç›’', id: 'xiangqi', name: 'ä¸­å›½è±¡æ£‹', icon: 'â™Ÿï¸', type: 'sandbox', preset: 'xiangqi' },
    { cat: 'è‡ªç”±æ²™ç›’', id: 'chess', name: 'å›½é™…è±¡æ£‹', icon: 'â™”', type: 'sandbox', preset: 'chess' },
    { cat: 'è‡ªç”±æ²™ç›’', id: 'go', name: 'å›´æ£‹ (è‡ªç”±)', icon: 'ğŸ”²', type: 'sandbox', preset: 'go' },
    { cat: 'è‡ªç”±æ²™ç›’', id: 'checkers', name: 'è¥¿æ´‹è·³æ£‹', icon: 'ğŸ”˜', type: 'sandbox', preset: 'checkers' },
    { cat: 'è‡ªç”±æ²™ç›’', id: 'shogi', name: 'æ—¥æœ¬å°†æ£‹', icon: 'ğŸ¯', type: 'sandbox', preset: 'shogi' },
    { cat: 'è‡ªç”±æ²™ç›’', id: 'ludo', name: 'é£è¡Œæ£‹', icon: 'âœˆï¸', type: 'sandbox', preset: 'ludo' },
    { cat: 'è‡ªç”±æ²™ç›’', id: 'backgammon', name: 'åŒé™†æ£‹', icon: 'ğŸ²', type: 'sandbox', preset: 'bg' },
    
    // æ›´å¤šæ²™ç›’æ£‹ç±» (å¡«å……è‡³30æ¬¾)
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'animal', name: 'æ–—å…½æ£‹', icon: 'ğŸ¦', type: 'sandbox', preset: 'grid_4x9' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'army', name: 'å†›æ£‹', icon: 'ğŸš©', type: 'sandbox', preset: 'grid_5x12' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'nine', name: 'ä¹å­æ£‹', icon: 'ğŸ•¸ï¸', type: 'sandbox', preset: 'grid_7x7' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'six', name: 'å…­å­æ£‹', icon: 'â‡ï¸', type: 'sandbox', preset: 'grid_hex' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'fox', name: 'ç‹ç‹¸ä¸é¹…', icon: 'ğŸ¦Š', type: 'sandbox', preset: 'cross' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'amazon', name: 'äºšé©¬é€Šæ£‹', icon: 'ğŸ¹', type: 'sandbox', preset: 'grid_10x10' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'surakarta', name: 'è‹æ‹‰å¡å°”å¡”', icon: 'ğŸŒ€', type: 'sandbox', preset: 'grid_6x6' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'mancala', name: 'æ’­æ£‹', icon: 'ğŸ’Š', type: 'sandbox', preset: 'mancala' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'battleship', name: 'æµ·æˆ˜æ£‹', icon: 'ğŸš¢', type: 'sandbox', preset: 'grid_10x10' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'dots', name: 'ç‚¹æ ¼æ£‹', icon: 'â¬œ', type: 'sandbox', preset: 'grid_dots' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'yot', name: 'ç”±å–æ£‹', icon: 'ğŸ', type: 'sandbox', preset: 'grid_5x5' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'domino', name: 'å¤šç±³è¯º', icon: 'ğŸ€„', type: 'sandbox', preset: 'empty' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'bridge', name: 'æ¡¥ç‰Œ (è®°åˆ†æ¿)', icon: 'ğŸƒ', type: 'sandbox', preset: 'cards' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'mahjong', name: 'äºŒäººéº»å°†', icon: 'ğŸ€„', type: 'sandbox', preset: 'mj' },
    { cat: 'æ›´å¤šæ£‹ç±»', id: 'werewolf', name: 'ç‹¼äººæ£‹', icon: 'ğŸº', type: 'sandbox', preset: 'grid_5x5' }
];

// --- 2. æ ¸å¿ƒæ§åˆ¶å™¨ ---
const Engine = {
    currentGame: null,
    boardData: [],
    history: [],
    turn: 1, // 1: Player/Black, 2: AI/White
    isOver: false,

    init() {
        UI.renderList();
        this.load('gomoku'); // é»˜è®¤åŠ è½½
    },

    load(id) {
        const game = GAMES.find(g => g.id === id);
        this.currentGame = game;
        this.isOver = false;
        this.turn = 1;
        this.history = [];
        UI.updateTitle(game);
        UI.closeMenu();

        const wrap = document.getElementById('board-wrap');
        wrap.className = 'board-wrap'; // reset
        wrap.innerHTML = ''; // clear

        // åˆ†å‘åŠ è½½é€»è¾‘
        if (game.type === 'ai') LogicAI.init(game);
        else if (game.type === 'solo') LogicSolo.init(game);
        else if (game.type === 'sandbox') LogicSandbox.init(game);
    },

    restart() {
        this.load(this.currentGame.id);
    },

    undo() {
        if (this.currentGame.type === 'solo') return; // å•äººæ¸¸æˆä¸€èˆ¬ä¸æ‚”æ£‹
        if (this.history.length < 1) return;
        
        // æ¢å¤çŠ¶æ€
        const state = this.history.pop();
        this.boardData = JSON.parse(JSON.stringify(state.board));
        this.turn = state.turn;
        this.isOver = false;
        
        // åˆ·æ–°UI
        if (this.currentGame.type === 'ai') LogicAI.render();
        else if (this.currentGame.type === 'sandbox') LogicSandbox.render();
        
        UI.setStatus('å·²æ‚”æ£‹');
    },

    saveState() {
        this.history.push({
            board: JSON.parse(JSON.stringify(this.boardData)),
            turn: this.turn
        });
    }
};

// --- 3. AI å¯¹æˆ˜é€»è¾‘æ¨¡å— ---
const LogicAI = {
    config: {},
    
    init(game) {
        const wrap = document.getElementById('board-wrap');
        wrap.classList.add(game.id === 'tictactoe' ? 'skin-paper' : (game.id === 'reversi' ? 'skin-green' : (game.id==='connect4'?'skin-blue':'skin-wood')));
        
        // åˆå§‹åŒ–æ•°æ®
        if (game.id === 'gomoku') this.setupGrid(15, 15);
        else if (game.id === 'reversi') {
            this.setupGrid(8, 8);
            Engine.boardData[3][3]=2; Engine.boardData[3][4]=1; 
            Engine.boardData[4][3]=1; Engine.boardData[4][4]=2;
        }
        else if (game.id === 'connect4') this.setupGrid(7, 6); // w, h
        else if (game.id === 'tictactoe') this.setupGrid(3, 3);
        
        this.render();
        UI.setStatus('ä½ çš„å›åˆ');
    },

    setupGrid(w, h) {
        this.config = { w, h };
        Engine.boardData = Array(h).fill().map(() => Array(w).fill(0));
    },

    render() {
        const wrap = document.getElementById('board-wrap');
        wrap.innerHTML = '';
        const board = document.createElement('div');
        board.className = 'board';
        
        // åŠ¨æ€æ ¼å­å¤§å°
        const size = Engine.currentGame.id === 'tictactoe' ? 100 : (Engine.currentGame.id === 'gomoku' ? 30 : 45);
        board.style.gridTemplateColumns = `repeat(${this.config.w}, ${size}px)`;
        
        // æ¸²æŸ“æ ¼å­
        for (let y = 0; y < this.config.h; y++) {
            for (let x = 0; x < this.config.w; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.style.width = size + 'px';
                cell.style.height = size + 'px';
                cell.onclick = () => this.playerMove(x, y);
                
                const val = Engine.boardData[y][x];
                if (val !== 0) {
                    const p = document.createElement('div');
                    p.className = `piece ${val === 1 ? 'b' : 'w'} show`;
                    // äº•å­—æ£‹ç‰¹æ®Šå¤„ç†
                    if (Engine.currentGame.id === 'tictactoe') {
                        p.innerText = val === 1 ? 'âŒ' : 'â­•';
                        p.style.background = 'none'; p.style.fontSize='2rem'; p.style.boxShadow='none';
                        p.style.color = val===1?'#ff6b6b':'#4ecdc4';
                    }
                    // å››å­æ£‹ç‰¹æ®Šå¤„ç† (é¢œè‰²)
                    if (Engine.currentGame.id === 'connect4') {
                        p.style.background = val===1 ? '#e74c3c' : '#f1c40f';
                    }
                    cell.appendChild(p);
                } else if (Engine.currentGame.id === 'reversi' && Engine.turn===1 && this.canFlip(x,y,1)) {
                     const hint = document.createElement('div'); hint.className='hint';
                     cell.appendChild(hint);
                }
                board.appendChild(cell);
            }
        }
        wrap.appendChild(board);
    },

    playerMove(x, y) {
        if (Engine.isOver || Engine.turn !== 1) return;
        
        // è§„åˆ™æ£€æŸ¥
        if (Engine.currentGame.id === 'connect4') {
            y = this.getDropRow(x); // é‡åŠ›ä¸‹è½
            if (y === -1) return;
        } else {
            if (Engine.boardData[y][x] !== 0) return;
            if (Engine.currentGame.id === 'reversi' && !this.canFlip(x,y,1)) return;
        }

        Engine.saveState();
        this.executeMove(x, y, 1);

        // èƒœè´Ÿåˆ¤å®š
        if (this.checkWin(x, y, 1)) {
            Engine.isOver = true; UI.setStatus('ğŸ‰ ä½ èµ¢äº†ï¼'); return;
        }
        // å¹³å±€åˆ¤å®š
        if (this.checkDraw()) {
            Engine.isOver = true; UI.setStatus('ğŸ¤ å¹³å±€'); return;
        }

        // åˆ‡æ¢ AI
        Engine.turn = 2;
        UI.setStatus('AI æ€è€ƒä¸­...');
        setTimeout(() => this.aiMove(), 500);
    },

    executeMove(x, y, p) {
        Engine.boardData[y][x] = p;
        // é»‘ç™½æ£‹ç¿»è½¬é€»è¾‘
        if (Engine.currentGame.id === 'reversi') {
            this.getFlips(x, y, p).forEach(pt => Engine.boardData[pt.y][pt.x] = p);
        }
        this.render();
        AudioSys.play('move');
    },

    aiMove() {
        if (Engine.isOver) return;
        
        // é€šç”¨è´ªå¿ƒ AI
        let bestMove = null;
        let bestScore = -Infinity;
        const moves = this.getValidMoves();

        // 1. å°è¯•èµ¢
        for (let m of moves) {
            Engine.boardData[m.y][m.x] = 2; // è¯•ä¸‹
            if (this.checkWin(m.x, m.y, 2)) {
                bestMove = m; Engine.boardData[m.y][m.x] = 0; break;
            }
            Engine.boardData[m.y][m.x] = 0;
        }

        // 2. å°è¯•å µ
        if (!bestMove) {
            for (let m of moves) {
                Engine.boardData[m.y][m.x] = 1; // å‡è®¾ç©å®¶ä¸‹
                if (this.checkWin(m.x, m.y, 1)) {
                    bestMove = m; Engine.boardData[m.y][m.x] = 0; break;
                }
                Engine.boardData[m.y][m.x] = 0;
            }
        }

        // 3. éšæœº/æƒé‡
        if (!bestMove && moves.length > 0) {
            if (Engine.currentGame.id === 'reversi') {
                // ä¼˜å…ˆå è§’
                bestMove = moves.reduce((prev, curr) => {
                   const score = (curr.x===0||curr.x===7) && (curr.y===0||curr.y===7) ? 100 : this.getFlips(curr.x, curr.y, 2).length;
                   return score > prev.score ? {move:curr, score} : prev;
                }, {move:moves[0], score:-1}).move;
            } else {
                bestMove = moves[Math.floor(Math.random()
